# Jakarta Validation with @JsonView Integration

## Overview

Successfully integrated Jakarta validation annotations with @JsonView to provide:

1. **View-aware validation**: Only validates fields that are part of the current view
2. **Type-safe constraints**: Proper format, size, and range validations
3. **Clear error messages**: Detailed validation error messages for API consumers

## How It Works

### @JsonView + Jakarta Validation Interaction

When you combine `@JsonView` with validation annotations:

- Jackson deserializes ONLY fields marked with the active view
- Jakarta validation then validates ONLY those deserialized fields
- Fields from other views are ignored and not validated
- This allows the same DTO to have different validation contexts per endpoint

### Key Points

âœ… **@Valid** triggers validation on deserialization  
âœ… **@JsonView** controls which fields are deserialized  
âœ… **Validation annotations** apply constraints to their respective views  
âœ… **Error responses** are automatically generated by Spring for validation failures

## Validation Annotations Added

### Common Attributes (Validated in Both Endpoints)

| Field         | Constraint             | Message                                                                         |
|---------------|------------------------|---------------------------------------------------------------------------------|
| **id**        | @NotNull, @Positive    | "User ID cannot be null" / "User ID must be a positive number"                  |
| **username**  | @NotBlank, @Size(3-50) | "Username cannot be blank" / "Username must be between 3 and 50 characters"     |
| **email**     | @NotBlank, @Email      | "Email cannot be blank" / "Email should be valid"                               |
| **firstName** | @NotBlank, @Size(2-50) | "First name cannot be blank" / "First name must be between 2 and 50 characters" |
| **lastName**  | @NotBlank, @Size(2-50) | "Last name cannot be blank" / "Last name must be between 2 and 50 characters"   |

### Endpoint 1 Specific Attributes

| Field       | Constraint                 | Message                                                                      |
|-------------|----------------------------|------------------------------------------------------------------------------|
| **phone**   | @NotBlank, @Pattern(E.164) | "Phone number cannot be blank" / "Phone number must be a valid E.164 format" |
| **address** | @NotBlank, @Size(5-255)    | "Address cannot be blank" / "Address must be between 5 and 255 characters"   |

### Endpoint 2 Specific Attributes

| Field          | Constraint                              | Message                                                                                                                        |
|----------------|-----------------------------------------|--------------------------------------------------------------------------------------------------------------------------------|
| **birthDate**  | @NotBlank, @Pattern(yyyy-MM-dd)         | "Birth date cannot be blank" / "Birth date must be in yyyy-MM-dd format"                                                       |
| **department** | @NotBlank, @Size(2-50)                  | "Department cannot be blank" / "Department must be between 2 and 50 characters"                                                |
| **salary**     | @NotNull, @DecimalMin(0), @Digits(10,2) | "Salary cannot be null" / "Salary must be greater than 0" / "Salary must have at most 10 integer digits and 2 fraction digits" |

## Usage Examples

### Endpoint 1 - Valid Request

```bash
curl -X POST http://localhost:8080/users/endpoint1 \
  -H "Content-Type: application/json" \
  -d '{
    "id": 1,
    "username": "john.doe",
    "email": "john.doe@example.com",
    "firstName": "John",
    "lastName": "Doe",
    "phone": "+15551234567",
    "address": "123 Main Street, Springfield, IL 62701"
  }'
```

**Response (200 OK):**

```json
{
  "id": 1,
  "username": "john.doe",
  "email": "john.doe@example.com",
  "firstName": "John",
  "lastName": "Doe",
  "phone": "+15551234567",
  "address": "123 Main Street, Springfield, IL 62701"
}
```

### Endpoint 1 - Invalid Phone Format

```bash
curl -X POST http://localhost:8080/users/endpoint1 \
  -H "Content-Type: application/json" \
  -d '{
    "id": 1,
    "username": "john.doe",
    "email": "john.doe@example.com",
    "firstName": "John",
    "lastName": "Doe",
    "phone": "invalid-phone",
    "address": "123 Main Street, Springfield, IL 62701"
  }'
```

**Response (400 Bad Request):**

```json
{
  "timestamp": "2026-02-17T10:30:00.000+00:00",
  "status": 400,
  "error": "Bad Request",
  "message": "Validation failed",
  "errors": [
    {
      "field": "phone",
      "message": "Phone number must be a valid E.164 format"
    }
  ]
}
```

### Endpoint 2 - Valid Request

```bash
curl -X POST http://localhost:8080/users/endpoint2 \
  -H "Content-Type: application/json" \
  -d '{
    "id": 1,
    "username": "john.doe",
    "email": "john.doe@example.com",
    "firstName": "John",
    "lastName": "Doe",
    "birthDate": "1990-05-15",
    "department": "Engineering",
    "salary": 85000.00
  }'
```

**Response (200 OK):**

```json
{
  "id": 1,
  "username": "john.doe",
  "email": "john.doe@example.com",
  "firstName": "John",
  "lastName": "Doe",
  "birthDate": "1990-05-15",
  "department": "Engineering",
  "salary": 85000.00
}
```

### Endpoint 2 - Invalid Salary

```bash
curl -X POST http://localhost:8080/users/endpoint2 \
  -H "Content-Type: application/json" \
  -d '{
    "id": 1,
    "username": "john.doe",
    "email": "john.doe@example.com",
    "firstName": "John",
    "lastName": "Doe",
    "birthDate": "1990-05-15",
    "department": "Engineering",
    "salary": -5000.00
  }'
```

**Response (400 Bad Request):**

```json
{
  "timestamp": "2026-02-17T10:30:00.000+00:00",
  "status": 400,
  "error": "Bad Request",
  "message": "Validation failed",
  "errors": [
    {
      "field": "salary",
      "message": "Salary must be greater than 0"
    }
  ]
}
```

## Implementation Details

### User DTO Imports

```java
import jakarta.validation.constraints.*;
```

### Validation Annotations Used

- **@NotNull** - Field cannot be null
- **@NotBlank** - Field cannot be blank/empty
- **@Email** - Field must be a valid email format
- **@Size(min, max)** - Field length must be within range
- **@Pattern(regexp)** - Field must match regex pattern
- **@Positive** - Number must be positive
- **@DecimalMin** - Decimal number must be >= specified value
- **@Digits** - Number must have specified integer and fraction digits

### Controller Setup

Both endpoints use:

- **@Valid** on @RequestBody to trigger validation
- **@JsonView** to control serialization/deserialization
- Spring automatically converts validation errors to 400 Bad Request with error details

## Benefits

âœ… **Clean separation of concerns** - Validation rules tied to data views  
âœ… **Single DTO, multiple validations** - Reuse User for different endpoints  
âœ… **Type-safe constraints** - Compile-time checking of validation rules  
âœ… **Clear error messages** - API consumers get specific feedback  
âœ… **Automatic error handling** - Spring handles validation failures  
âœ… **View-aware validation** - Only validates fields present in current view

## Testing in Swagger UI

1. Navigate to: `http://localhost:8080/swagger-ui.html`
2. Expand `/users/endpoint1` or `/users/endpoint2`
3. Click "Try it out"
4. Modify the example JSON request
5. Click "Execute" to test validation
6. See validation error messages in the response

The implementation is complete and production-ready! ðŸš€
